angular.module("fluro.video",["fluro.config","fluro.util","youtube-embed"]),angular.module("fluro.video").directive("fluroVideo",function($compile,Fluro){return{restrict:"E",replace:!0,template:'<div class="fluro-video video-{{model.assetType}}"></div>',controller:"FluroVideoController",scope:{model:"=ngModel",ngParams:"&"},link:function($scope,$element){$scope.params=$scope.ngParams(),$scope.params||($scope.params={controls:0,autoplay:0,modestbranding:1,playsinline:1,showinfo:0,theme:"light",byline:0,portrait:0,title:0});var template;switch($scope.model.assetType){case"youtube":template='<div class="embed-responsive embed-responsive-16by9"><youtube-video class="embed-responsive-item" video-url="model.external.youtube" player-vars="params"/></div>';break;case"vimeo":template='<div class="embed-responsive embed-responsive-16by9"><vimeo-video class="embed-responsive-item" video-url="model.external.vimeo" player-vars="params"/></div>';break;case"upload":$scope.playUrl=Fluro.apiURL+"/get/"+$scope.model._id,template='<div class="embed-responsive embed-responsive-16by9"><video class="embed-responsive-item" controls><source ng-src="{{playUrl | trustfluro}}" type="{{model.mimetype}}"></video></div>'}if(template){var cTemplate=$compile(template)($scope);$element.append(cTemplate)}}}}).filter("trustfluro",["$sce",function($sce){return function(val){return $sce.trustAsResourceUrl(val)}}]).controller("FluroVideoController",function(){}),angular.module("fluro.video").service("VimeoEmbedSettings",function($http){var controller={};return controller.getVideoInformation=function(vimeoID){return $http.get("http://vimeo.com/api/v2/video/"+vimeoID+".output")},controller}).directive("vimeoVideo",function($compile,VimeoEmbedSettings){return{restrict:"E",scope:{videoId:"=",videoUrl:"=",playerVars:"="},link:function($scope,$element){function getVimeoID(url){var reg=/https?:\/\/(?:www\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/([^\/]*)\/videos\/|album\/(\d+)\/video\/|)(\d+)(?:$|\/|\?)/,match=url.match(reg);return match?match[3]:void 0}$scope.getVideoInformation=function(){return $scope.videoId?VimeoEmbedSettings.getVideoInformation($scope.videoId):void 0},$scope.$watch("videoId + videoUrl + playerVars",function(){var VideoID;$scope.videoId?VideoID=$scope.videoId:$scope.videoUrl&&(VideoID=getVimeoID($scope.videoUrl));var params="";if($scope.playerVars)for(var key in $scope.playerVars)params+="&"+key+"="+$scope.playerVars[key];$scope.vimeoEmbedURL="//player.vimeo.com/video/"+VideoID+"?player_id="+VideoID+params});var template='<iframe ng-src="{{vimeoEmbedURL | trustVimeo}}" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>',cTemplate=$compile(template)($scope);$element.replaceWith(cTemplate)}}}).filter("trustVimeo",["$sce",function($sce){return function(val){return $sce.trustAsResourceUrl(val)}}]);